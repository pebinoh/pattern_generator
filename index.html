<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zipworks Clone - Pattern Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            color: #333;
        }

        /* --- Sidebar Gauche --- */
        .info-panel {
            width: 300px;
            padding: 40px;
            border-right: 1px solid #eee;
            overflow-y: auto;
        }

        h1 { font-size: 2.5rem; margin-top: 0; font-weight: 800; letter-spacing: -1px; }
        .badge { background: #f0f0f0; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }

        /* --- Zone Centrale (3D) --- */
        .preview-container {
            flex-grow: 1;
            position: relative;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #canvas-3d { width: 100%; height: 100%; outline: none; }
        .preview-label { position: absolute; top: 20px; font-weight: bold; color: #888; }
        .volume-display { position: absolute; bottom: 100px; color: #555; }
        .btn-generate {
            position: absolute;
            bottom: 40px;
            background: #e0e0e0;
            border: none;
            padding: 15px 40px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }

        /* --- Sidebar Droite (Contrôles) --- */
        .controls-panel {
            width: 320px;
            padding: 30px;
            background: #fff;
            border-left: 1px solid #eee;
            overflow-y: auto;
        }

        .control-group { margin-bottom: 20px; }
        label { display: block; font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .row { display: flex; gap: 10px; }
        .unit-toggle { display: flex; margin-bottom: 20px; }
        .unit-toggle button {
            flex: 1; padding: 8px; border: 1px solid #ccc; background: white; cursor: pointer;
        }
        .unit-toggle button.active { background: #eee; font-weight: bold; }
    </style>
</head>
<body>

    <div class="info-panel">
        <h1>zipworks</h1>
        <h3>Pattern Generator</h3>
        <p>Outil pour créer un patron de couture pour une pochette avec fermeture éclair.</p>
        <hr>
        <p><small><strong>Disclaimer:</strong> Logiciel en beta. Vérifiez vos calculs.</small></p>
    </div>

    <div class="preview-container">
        <div class="preview-label">360° Preview</div>
        <canvas id="canvas-3d"></canvas>
        <div class="volume-display" id="volume-text">Volume: 0.2L</div>
        <button class="btn-generate">Generate pattern!</button>
    </div>

    <div class="controls-panel">
        <div class="unit-toggle">
            <button class="active">in</button>
            <button>cm</button>
        </div>

        <div class="control-group">
            <label>Construction ⓘ</label>
            <select id="construction">
                <option>1 Panel</option>
                <option>2 Panels</option>
            </select>
        </div>

        <div class="control-group">
            <label>Length (Top / Bottom)</label>
            <div class="row">
                <input type="number" id="lenTop" value="4" step="0.1">
                <input type="number" id="lenBot" value="4" step="0.1">
            </div>
        </div>

        <div class="control-group">
            <label>Width</label>
            <input type="number" id="width" value="1" step="0.1">
        </div>

        <div class="control-group">
            <label>Height</label>
            <input type="number" id="height" value="2.75" step="0.1">
        </div>

        <div class="control-group">
            <label>Seam allowance ⓘ</label>
            <input type="number" id="seam" value="0.25" step="0.05">
        </div>

        <div class="control-group">
            <label>Zipper width ⓘ</label>
            <input type="number" id="zipWidth" value="1" step="0.1">
        </div>

        <div class="control-group">
            <label>Zipper reach ⓘ</label>
            <input type="range" id="zipReach" min="0" max="100" value="70">
        </div>
    </div>

    <script>
        // --- INITIALISATION THREE.JS ---
        const canvas = document.querySelector('#canvas-3d');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xffffff);

        const camera = new THREE.PerspectiveCamera(45, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
        camera.position.set(5, 5, 5);

        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // Lumières
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));

        // Création du Mesh (Pochette)
        let geometry = new THREE.BoxGeometry(1, 1, 1);
        const material = new THREE.MeshPhongMaterial({ 
            color: 0xffffff, 
            wireframe: false,
            transparent: true,
            opacity: 0.5
        });
        const pouch = new THREE.Mesh(geometry, material);
        scene.add(pouch);

        // Bordures (Edges)
        const edges = new THREE.EdgesGeometry(geometry);
        const lineMat = new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 });
        const wireframe = new THREE.LineSegments(edges, lineMat);
        scene.add(wireframe);

        // --- MISE À JOUR EN TEMPS RÉEL ---
        function updateGeometry() {
            const L = parseFloat(document.getElementById('lenTop').value) || 1;
            const W = parseFloat(document.getElementById('width').value) || 1;
            const H = parseFloat(document.getElementById('height').value) || 1;

            // Mise à jour de l'échelle du mesh
            pouch.scale.set(L, H, W);
            wireframe.scale.set(L, H, W);

            // Calcul du volume simple (L*W*H) - Conversion arbitraire pour l'exemple
            const volume = (L * W * H * 0.016387).toFixed(2); // cubic inches to Liters approx
            document.getElementById('volume-text').innerText = `Volume: ${volume}L`;
        }

        // Écouteurs d'événements sur les inputs
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('input', updateGeometry);
        });

        // --- BOUCLE D'ANIMATION ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            
            // Ajustement taille canvas si redimensionnement fenêtre
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            if (canvas.width !== width || canvas.height !== height) {
                renderer.setSize(width, height, false);
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
            }
            
            renderer.render(scene, camera);
        }

        updateGeometry();
        animate();
    </script>
</body>
</html>
